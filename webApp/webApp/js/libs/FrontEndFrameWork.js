/*
wRouter.js
write by wuweiwei
www.github.com/flybirdsoft
*/
!function(win){"use strict";var wRouter={version:"1.0",route:[],defRouteIndex:0,commonControllerHandler:function(t){},endControllerHandler:function(t){},isFirstLoad:!0,prevControllerName:""};wRouter.event={},wRouter.http={useMask:!0},wRouter.template={},wRouter.location={url:"",host:"",fileName:"",port:"",param:"",params:[],action:""},wRouter.isIE=function(){return navigator.userAgent.indexOf("MSIE 7")>0||navigator.userAgent.indexOf("MSIE 6")>0},wRouter.isIE8=function(){return navigator.userAgent.indexOf("MSIE 8")>0},wRouter.onLoad=function(){window.onload=function(){window.location.href.indexOf("#")==-1&&(window.location.href=wRouter.location.fileName+"#"+wRouter.route.routes[wRouter.defRouteIndex].url.replace(/\/:\w{1,}/,""),wRouter.isIE()&&wRouter.event.onhashchange())}},wRouter.location.getURL=function(t){this.url=void 0!=t?decodeURI(t):decodeURI(location.href),this.convertURL()},wRouter.location.convertURL=function(){var t,e,o,r,n={key:"",value:""};if(t=/\/[\u4E00-\u9FFF]+|\w+\.html/,t.exec(this.url)&&(this.fileName=t.exec(this.url)[0]),t=/#\S{0,}/,null!=t.exec(this.url)&&(this.action=t.exec(this.url)[0],this.action=this.action.replace("#",""),this.action=this.action.replace(/\?\S+/,""),"/"!=this.action.substr(0,1)&&(this.action="/"+this.action),"/"==this.action.substr(this.action.length-1,1)&&(this.action=this.action.substr(0,this.action.length-1))),t=/\?\S{0,}/,null!=t.exec(this.url))for(this.params=[],this.param=t.exec(this.url)[0],this.param=this.param.replace("?",""),e=this.param.split("&"),r=0;r<e.length;r++)n={key:"",value:""},o=e[r].split("="),n.key=o[0],n.value=o[1],this.params.push(n);this.param=this.param.replace("?","")},win.$location=wRouter.location,wRouter.config=function(t){this.route=t,wRouter.controlLink(),wRouter.onLoad()},wRouter.addRoute=function(t){var e;if(void 0==t.length)this.route.routes.push(t);else for(e=0;e<t.length;e++)this.route.routes.push(t[e])},wRouter.commonController=function(t){wRouter.commonControllerHandler=void 0!=t?t:function(){}},wRouter.endController=function(t){wRouter.endControllerHandler=void 0!=t?t:function(){}},wRouter.controller=function(t,e){var o,r,n;if(0!=this.route.length){for(n=this.route.routes,r=n.length,this.route.otherwise,o=0;o<r;o++)if(n[o].controller==t)return n[o].handler=e,this.run(n[o]),void(n[o].url!=this.route.otherwise.redirectTo&&n[o].url.replace(/\/:\w{1,}/,"")!=this.route.otherwise.redirectTo||(this.defRouteIndex=o));o==r&&(window.location.href=wRouter.location.fileName+"#"+n[this.defRouteIndex].url.replace(/\/:\w{1,}/,""))}},wRouter.callController=function(t,e){var o,r,n,i={};for(n=this.route.routes,r=n.length,i=e,o=0;o<r;o++)n[o].controller==t&&n[o].handler.call(this,i)},wRouter.run=function(t){wRouter.mask.init(),wRouter.location.getURL(),this.compareURL(t),window.onhashchange=function(t){var e;e=t||event,wRouter.location.getURL(e.newURL),wRouter.compareURLs()},this.event.onhashchange=function(){wRouter.location.getURL(location.href),wRouter.compareURLs()}},wRouter.trigger=function(t){if(navigator.userAgent.indexOf("MSIE 7")>0)return void wRouter.event[t].call(this);try{wRouter.event[t].call(this)}catch(t){}},wRouter.compareURL=function(t){var e,o,r,n=/\/:\w{1,}/g,i="",a={},s={},l=this.route.routes;if(t=t,e=wRouter.location.action,o=t.url,t.url.indexOf(":")>0){i=t.url.replace(n,""),s=this.mapRouteUrlParam(t.url,e.replace(i,""));for(r in s)a[r]=s[r]}if("/"!=o.substr(0,1)&&(o="/"+o),o==e)return wRouter.template.tmpl(t),wRouter.commonControllerHandler.call(this,wRouter.isFirstLoad),wRouter.isFirstLoad=!1,t.handler.call(this,a),wRouter.endControllerHandler.call(this,this.prevControllerName),void(this.prevControllerName=t.controller);t.url.indexOf(":")>0&&i==e.substr(0,i.length)&&(i.length!=e.length&&"/"!=e.substr(i.length,1)&&(window.location.href=wRouter.location.fileName+"#"+l[this.defRouteIndex].url.replace(n,"")),wRouter.template.tmpl(t),wRouter.commonControllerHandler.call(this,wRouter.isFirstLoad),wRouter.isFirstLoad=!1,t.handler.call(this,a),wRouter.endControllerHandler.call(this,this.prevControllerName),this.prevControllerName=t.controller)},wRouter.compareURLs=function(){var t,e,o,t,r,n,i,a=/\/:\w{1,}/g,s="",l={},u={};for(n=this.route.routes,r=n.length,e=wRouter.location.action,t=0;t<r;t++){if(o=n[t].url,n[t].url.indexOf(":")>0){s=n[t].url.replace(a,""),u=this.mapRouteUrlParam(n[t].url,e.replace(s,""));for(i in u)l[i]=u[i]}if("/"!=o.substr(0,1)&&(o="/"+o),o==e)return wRouter.template.tmpl(n[t]),wRouter.commonControllerHandler.call(this,wRouter.isFirstLoad),wRouter.isFirstLoad=!1,n[t].handler.call(this,l),wRouter.endControllerHandler.call(this,this.prevControllerName),void(this.prevControllerName=n[t].controller);if(n[t].url.indexOf(":")>0&&s==e.substr(0,s.length))return s.length!=e.length&&"/"!=e.substr(s.length,1)&&(window.location.href=wRouter.location.fileName+"#"+n[this.defRouteIndex].url.replace(a,"")),wRouter.template.tmpl(n[t]),wRouter.commonControllerHandler.call(this,wRouter.isFirstLoad),wRouter.isFirstLoad=!1,n[t].handler.call(this,l),wRouter.endControllerHandler.call(this,this.prevControllerName),void(this.prevControllerName=n[t].controller)}t==r&&(window.location.href=wRouter.location.fileName+"#"+n[this.defRouteIndex].url.replace(a,""))},wRouter.mapRouteUrlParam=function(t,e){var o,r=[],n=[],i="",a="",s={},l=-1;for(l=t.indexOf("/:"),t=t.substr(l),i=t.replace("/:",""),r=i.split("/:"),a="/"==e.substr(0,1)?e.substr(1):e,n=a.split("/"),""==n[0]&&(n[0]=void 0),o=0;o<r.length;o++)s[r[o]]=n[o];return s},wRouter.Injection=function(t,e){var o,r,n=/\(\S+\)/,i=t.toString(),a=n.exec(i),s=[];if(null!=a&&(a=a[0].replace("(","").replace(")",""),s[0]=a,a.indexOf(",")>0&&(s=a.split(",")),"string"==typeof e))for(o=0;o<s.length;o++)for(r=0;r<e.length;r++)s[o],e[r]},wRouter.template.tmpl=function(t){if(void 0!=wRouter.route.container)if(void 0!=t.template)try{wRouter.route.container.innerHTML=t.template.innerHTML}catch(t){throw new Error("没有找到模板")}else if(void 0!=t.templateUrl)try{var e={url:t.templateUrl,data:{},async:!1,success:function(t){},error:function(){}};wRouter.http.getTmpl(e)}catch(t){throw new Error("没有找到模板")}},wRouter.template.loadTmpl=function(t){wRouter.http.getTmpl(t)};var $template={};win.$template=$template,wRouter.http.get=function(options){wRouter.http.useMask&&wRouter.mask.show();var th=wRouter.http;wAjax.ajax({url:options.url,type:"GET",dataType:"text",data:options.param||options.data,success:function(data){var json=eval("("+data+")");void 0!=options.success&&options.success.call(th,json),setTimeout(wRouter.mask.hide,100)},error:function(){void 0!=options.error&&(wRouter.mask.hide(),options.error.call(th))}})},wRouter.http.getTmpl=function(t){var e=t.container||wRouter.route.container,o=wRouter.template,r=!0;void 0!=t.async&&0==t.async&&(r=!1),wAjax.ajax({url:t.url,type:"GET",dataType:"html",data:t.param||t.data,async:r,success:function(r){void 0!=t.success&&(e.innerHTML=r,t.success.call(o,r))},error:function(){void 0!=t.success&&t.error.call(o)}})},wRouter.http.postData=function(t){if(void 0==t.url)throw new Error("参数不足");wAjax.ajax({url:t.url,type:"POST",data:$(t.form).serialize(),success:function(e){void 0!=t.success&&t.success.call(this,e)},error:function(){void 0!=t.error&&t.error.call(this,data)}})},wRouter.http.template=function(t){var e="";return wAjax.ajax({url:t,type:"GET",dataType:"html",async:!1,success:function(t){e=t.toString()},error:function(t){e="error"}}),e};var $http={};$http.get=wRouter.http.get,$http.getTmpl=wRouter.http.getTmpl,$http.postData=wRouter.http.postData,$http.template=wRouter.http.template,win.$http=$http,wRouter.controlLink=function(){var t=/#\S+/,e="";$("a[route]").click(function(){return e=this.href.replace("file://",""),e=e.replace("http://",""),e=t.exec(e),null!=e&&(e=e[0].replace("#","/"),window.location.href=wRouter.location.fileName+"#"+e),wRouter.isIE()&&wRouter.event.onhashchange(window.location.href),!1})},wRouter.mask={created:!1},wRouter.mask.init=function(){wRouter.mask.created||(this.created=!0,this.maskDiv=document.createElement("div"),this.maskDiv.id="_mask_",this.maskDiv.style.position="fixed",this.maskDiv.style.width="100%",this.maskDiv.style.height="100%",this.maskDiv.style.top="0",this.maskDiv.style.left="0",this.maskDiv.style["z-index"]="1000",this.maskDiv.style._position="absolute",this.maskDiv.style.background="#CCC",this.maskDiv.style.opacity="0.4",this.maskDiv.style.filter="alpha(opacity=40)",this.maskDiv.style["text-align"]="center",this.maskDiv.style["vertical-align"]="middle",this.maskDiv.style["padding-top"]="100px",this.maskDiv.style.display="none",this.maskDiv.innerHTML="载入中......",document.getElementsByTagName("body")[0].appendChild(this.maskDiv))},wRouter.mask.show=function(){this.maskDiv.style.display="block"},wRouter.mask.hide=function(){document.getElementById("_mask_").style.display="none"};var wAjax={xmlhttp:null,getFormData:function(t){for(var e=new Array,o=0;o<oForm.elements.length;o++){var r=encodeURIComponent(oForm.elements[o].name);r+="=",r+=encodeURIComponent(oForm.elements[o].value),e.push(r)}return e.join("&")},getParamData:function(t){var e,o="?interval=";if(o+=(new Date).getTime(),void 0==t)return"";for(e in t)o=o+"&"+e+"="+t[e];return o},ajax:function(options){this.options=options;var th=this,data,submitData,async=!0;if(void 0==options.async||options.async||(async=!1),window.XMLHttpRequest)this.xmlhttp=new XMLHttpRequest;else{var arr=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];for(i=0;i<arr.length;i++)try{return void(this.xmlhttp=new ActiveXObject(arr[i]))}catch(t){}}"GET"==options.type?(this.xmlhttp.open("get",options.url+this.getParamData(options.data),async),this.xmlhttp.onreadystatechange=function(){4==th.xmlhttp.readyState&&200==th.xmlhttp.status?(void 0==options.dataType||"text"==options.dataType||"html"==options.dataType?data=th.xmlhttp.responseText:"json"==options.dataType.toLowerCase()&&(data=eval("("+th.xmlhttp.responseText+")")),options.success(data)):options.error(data)},this.xmlhttp.send(null)):"POST"==options.type&&(this.xmlhttp.open("post",options.url,async),this.xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlhttp.onreadystatechange=function(){4==th.xmlhttp.readyState&&200==th.xmlhttp.status?(void 0==options.dataType||"text"==options.dataType||"html"==options.dataType?data=th.xmlhttp.responseText:"json"==options.dataType.toLowerCase()&&(data=eval("("+th.xmlhttp.responseText+")")),options.success(data)):options.error(data)},submitData=this.getParamData(options.data),this.xmlhttp.send(submitData))}};win.wRouter=wRouter}(window);

/*
template.js
write by wuweiwei
www.github.com/flybirdsoft
*/
/*
!function(e){var t={_startSymbol:"\\${",_endSymbol:"}",templateElement:{},contentNode:null};t.startSymbol=function(e){var t,n="",o="^$*+?{}[]|.";for(t=0;t<e.length;t++)o.indexOf(e.substr(t,1))>=0&&(n+="\\"),n+=e.substr(t,1);this._startSymbol=n},t.endSymbol=function(e){var t,n="",o="^$*+?{}[]|.";for(t=0;t<e.length;t++)o.indexOf(e.substr(t,1))>=0&&(n+="\\"),n+=e.substr(t,1);this._endSymbol=e},t.repeat=function(e){if(void 0==e.data)throw new Error("参数名称不对,参数是{},缺少data");if(void 0==e.repeatId&&void 0==e.repeatElement)throw new Error("参数名称不对,参数是{},缺少repeatElement或repeatId");var n,o,r,i,l,a,s,i,d,p,m={string:""},b=[],c=0,g=null,y=null,f=function(){},u={},h=null,v="";for(l=e.repeatElement||$(e.repeatId)[0],a=l.parentNode,(void 0==e.type||void 0!=e.type&&"cover"==e.type)&&t.deleteNode(l),void 0==e.template&&(e.template=l.innerHTML),void 0==e.data.length?(c=1,b[0]=e.data):(c=e.data.length,b=e.data),void 0!=e.count&&e.count<=c&&(c=e.count),void 0!=e.process&&(f=e.process||e.onprocess),g=l,y=a.lastChild,void 0!=e.onloadBefore&&e.onloadBefore.call(this),n=c-1;n>=0;n--){for(r=b[n],u={index:n,item:b[n]},s=f.call(this,u),h=document.createElement(l.nodeName),o=0;o<l.attributes.length;o++){v=l.attributes.item(o).value;for(i in s)d=this._startSymbol+i+this._endSymbol,p=new RegExp(d,"g"),v=v.replace(p,s[i]);for(i in r)d=this._startSymbol+i+this._endSymbol,p=new RegExp(d,"g"),v=v.replace(p,r[i]);h.setAttribute(l.attributes.item(o).name,v)}m.string=e.template;for(i in s)"object"!=typeof s[i]?(d=this._startSymbol+i+this._endSymbol,p=new RegExp(d,"g"),m.string=m.string.replace(p,s[i])):t.getScope(s,i,m);for(i in r)"object"!=typeof r[i]?(d=this._startSymbol+i+this._endSymbol,p=new RegExp(d,"g"),m.string=m.string.replace(p,r[i])):t.getScope(r,i,m);h.innerHTML=m.string,void 0!=e.type&&"append"==e.type?(a.insertBefore(h,y.nextSibling),h.style.display="",h.setAttribute("templateItem","templateItem"),h=y):(a.insertBefore(h,g.nextSibling),h.style.display="",h.setAttribute("templateItem","templateItem"))}l.style.display="none",void 0!=e.onload&&e.onload.call(this),void 0!=e.bind},t.getScope=function(e,t,n,o){var r,i,l="";if(i=e[t],"object"==typeof i){l=void 0==o?t:o;for(r in i){if(l+="."+r,"object"==typeof i[r])return void this.getScope(i,r,n,l);strV=this._startSymbol+l+this._endSymbol,reg=new RegExp(strV,"g"),n.string=n.string.replace(reg,i[r])}}},t.deleteNode=function(e){var t=e.nextSibling;if(null!=t){var n,o;try{o=1==t.nodeType&&"templateItem"==t.getAttribute("templateItem")||1!=t.nodeType}catch(r){return}for(;null!=t&&o;)n=t.nextSibling,t.parentNode.removeChild(t),t=n}},e.T=e.template=t}(window);
*/

!function(e){var t={_startSymbol:"\\${",_endSymbol:"}",templateElement:{},contentNode:null};t.startSymbol=function(e){var t,i="",o="^$*+?{}[]|.";for(t=0;t<e.length;t++)o.indexOf(e.substr(t,1))>=0&&(i+="\\"),i+=e.substr(t,1);this._startSymbol=i},t.endSymbol=function(e){var t,i="",o="^$*+?{}[]|.";for(t=0;t<e.length;t++)o.indexOf(e.substr(t,1))>=0&&(i+="\\"),i+=e.substr(t,1);this._endSymbol=e},t.repeat=function(e){if(void 0==e.data)throw new Error("参数名称不对,参数是{},缺少data");if(void 0==e.repeatId&&void 0==e.repeatElement)throw new Error("参数名称不对,参数是{},缺少repeatElement或repeatId");var i,o,n,r,l,a,d,r,s,p,h={string:""},g=[],m=0,u=null,f=null,c=function(){},b={},y=null,v="";for(l=e.repeatElement||$(e.repeatId)[0],a=l.parentNode,(void 0==e.type||void 0!=e.type&&"cover"==e.type)&&t.deleteNode(l),void 0==e.template&&(e.template=l.innerHTML),void 0==e.data.length?(m=1,g[0]=e.data):(m=e.data.length,g=e.data),void 0!=e.count&&e.count<=m&&(m=e.count),void 0!=e.process&&(c=e.process||e.onprocess),u=l,f=a.lastChild,void 0!=e.onloadBefore&&e.onloadBefore.call(this),i=m-1;i>=0;i--){for(n=g[i],b={index:i,item:g[i]},d=c.call(this,b),y=document.createElement(l.nodeName),o=0;o<l.attributes.length;o++){v=l.attributes.item(o).value;for(r in d)s=this._startSymbol+r+this._endSymbol,p=new RegExp(s,"g"),v=v.replace(p,d[r]);for(r in n)s=this._startSymbol+r+this._endSymbol,p=new RegExp(s,"g"),v=v.replace(p,n[r]);y.setAttribute(l.attributes.item(o).name,v)}h.string=e.template;for(r in d)"object"!=typeof d[r]?(s=this._startSymbol+r+this._endSymbol,p=new RegExp(s,"g"),h.string=h.string.replace(p,d[r])):t.getScope(d,r,h);for(r in n)"object"!=typeof n[r]?(s=this._startSymbol+r+this._endSymbol,p=new RegExp(s,"g"),h.string=h.string.replace(p,n[r])):t.getScope(n,r,h);if(y.innerHTML=h.string,void 0!=e.type&&"append"==e.type){for(;null!=f&&(1!=f.nodeType||"templateItem"!=f.getAttribute("templateItem"));)f=f.previousSibling;a.insertBefore(y,f.nextSibling),y.style.display="",y.setAttribute("templateItem","templateItem"),y=f}else a.insertBefore(y,u.nextSibling),y.style.display="",y.setAttribute("templateItem","templateItem")}return l.style.display="none",void 0!=e.onload&&e.onload.call(this),void 0!=e.bind,new this.ModelView({data:e.data,target:l,parentNode:a})},t.getScope=function(e,t,i,o){var n,r,l="";if(r=e[t],"object"==typeof r){l=void 0==o?t:o;for(n in r){if(l+="."+n,"object"==typeof r[n])return void this.getScope(r,n,i,l);strV=this._startSymbol+l+this._endSymbol,reg=new RegExp(strV,"g"),i.string=i.string.replace(reg,r[n])}}},t.deleteNode=function(e){var t=e.nextSibling;if(null!=t){var i,o;try{o=1==t.nodeType&&"templateItem"==t.getAttribute("templateItem")||1!=t.nodeType}catch(n){return}for(;null!=t&&(i=t.nextSibling,o&&t.parentNode.removeChild(t),t=i,null!=t);)o=1==t.nodeType&&"templateItem"==t.getAttribute("templateItem")}},t.ModelView=function(e){this.data=e.data,this.parentNode=e.parentNode,this.target=e.target},t.ModelView.prototype.findNode=function(e){var t,i=0,o=!1,n=this.parentNode.childNodes,r=n.length;for(t=0;r>t;t++)if(this.target==n[t]&&(i=0,o=!0),1==n[t].nodeType&&i++,o&&i==e+2)return n[t];return null},t.ModelView.prototype.repeatToSingleNode=function(e,i){var o,n,r,l,a,d,s=this.target,p={string:""},h=this.row;for(p.string=s.innerHTML,o=void 0!=i&&i?document.createElement(s.nodeName):this.findNode(e),r=0;r<s.attributes.length;r++){l=s.attributes.item(r).value;for(n in h)d=t._startSymbol+n+t._endSymbol,a=new RegExp(d,"g"),l=l.replace(a,h[n]);o.setAttribute(s.attributes.item(r).name,l)}for(n in h)"object"!=typeof h[n]?(d=t._startSymbol+n+t._endSymbol,a=new RegExp(d,"g"),p.string=p.string.replace(a,h[n])):t.getScope(h,n,p);return o.innerHTML=p.string,o.style.display="",o},t.ModelView.prototype.doCondition=function(e){var t,i,o,n,r,l,a=this.data.length,d=this.data,s=!1,p=!1,h=-1;for(t in e){for(r=t.split("."),l=e[t],s=!1,p=!1,i=0;a>i;i++){for(n=d[i],o=0;o<r.length;o++)if(n=n[r[o]],void 0==n){s=!0;break}if(s)break;if(n==l){p=!0,h=i;break}p=!1}if(!p)break}return p?h:-1},t.ModelView.prototype.update=function(e,t,i){this.row=t;var o;o=this.doCondition(e),-1!=o&&(this.repeatToSingleNode(o),this.data[o]=t),i.call(this,-1==o?!1:!0)},t.ModelView.prototype["delete"]=function(e,t){var i,o;i=this.doCondition(e),o=this.findNode(i),o.parentNode.removeChild(o),this.data.splice(i,1),t.call(this)},t.ModelView.prototype.deleteIndex=function(e,t){var i;i=this.findNode(e),i.parentNode.removeChild(i),this.data.splice(e,1),void 0!=t&&t.call(this)},t.ModelView.prototype.add=function(e,t){var i,o=null;for(this.row=e,i=this.repeatToSingleNode(-1,!0),o=this.parentNode.lastChild;null!=o&&(1!=o.nodeType||"templateItem"!=o.getAttribute("templateItem"));)o=o.previousSibling;this.parentNode.insertBefore(i,o.nextSibling),this.data.push(e),void 0!=t&&t.call(this)},t.ModelView.prototype.insert=function(e,t,i){var o,n,r=null;for(this.row=t,o=this.repeatToSingleNode(-1,!0),r=this.target.nextSibling,n=0;e>n;n++)r=r.nextSibling;this.parentNode.insertBefore(o,r),this.data.splice(e,0,t),void 0!=i&&i.call(this)},t.ModelView.prototype.destroy=function(){this.data.length=0,this.parentNode=null,this.target=null},e.T=e.template=t}(window);


