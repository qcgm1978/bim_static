<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>模型选择器</title>
    
</head>
<body>
<script src="http://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
<script src="/static/dist/components/inspectSelection/js/inspectSelection.js"></script>
<script>
    function GetRequest() {
        var url = location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
    var Request = GetRequest();

    var viewer = new InspectModelSelection({
        type: Request.type,//open process
        sourceId: Request.sourceId,
        etag: Request.etag,
        projectId: Request.projectId,
        projectVersionId: Request.projectVersionId,
        ruleType: Request.ruleType,
        token: Request.token,
        appKey: Request.appKey,
        host: 'http://' + location.host,
        //res 选择的检查点数据
        callback: function (res) {
        }
    });

    function getData() {
        var userId = viewer.Project.currentUserId,
                fileId = viewer.Project.fileIds[userId] || "";

        var result = {
            presetPoint: viewer.Project.presetPoint,
            risk: {
                components: {
                    id: userId,
                    fileUniqueId: fileId + userId.slice(userId.indexOf('.')),
                    axis: viewer.Project.axis[userId],
                    location: viewer.Project.location[userId],
                    locationName: viewer.Project.locationName[userId]
                },
                markers: viewer.Project.Settings.markers
            }
        }
        return JSON.stringify(result);
    }

    function allIn(param) {
        var view = viewer.Project.Viewer,
                type = "readOnly";
        param = JSON.parse(param);
        param = param || {};
        viewer.Project.mode = type;
        viewer.Project.isSelect = true;
        view.loadMarkers(null);
        if (param.presetId && (!param.componentId && !param.location)) {
            type = "preset";
            viewer.Project.mode = type;
            showPresetPoint(param.presetId,true);
        }
        if (!param.presetId && (param.componentId && param.location)) {
            type = "risk";
            viewer.Project.mode = type;
            showRiskComponent(param.componentId, param.location);
        }

        if(param.presetId && param.componentId && param.location){
            showRiskComponent(param.componentId, param.location);
            showPresetPoint(param.presetId);
        }

        return type;
    }

    function clearRisk() {
        var view = viewer.Project.Viewer;
        view.highlight({
            type: "userId",
            ids: undefined
        })
        view.loadMarkers(null);
    }

    function showRiskComponent(componentId, location) {
        var view = viewer.Project.Viewer;
        view.highlight({
            type: "userId",
            ids: [componentId]
        });
        viewer.Project.currentRiskShowData={
            id:componentId,
            marker:JSON.stringify(location)
        }
        viewer.ModelFilter.recoverySilder();
        view.loadMarkers([JSON.stringify(location)]);
    }
    function showPresetPoint(presetId,isClearRisk) {

        if(isClearRisk){
            viewer.Project.currentRiskShowData=null;
        }

        var data = viewer.Project.catchPageData(null, {
            id: presetId
        });
        viewer.Project.OpeningAcceptanceCollection.push({data: data});
        viewer.Project.pageInfo(data, true);
        var t = $("tr[data-id='" + presetId + "']");
        t.trigger('click');
    }
    function clearPresetPoint() {
        var view = viewer.Project.Viewer;
        view.highlight({
            type: "userId",
            ids: undefined
        })
        view.loadMarkers(null);
        view.fit();
    }
</script>
</body>
</html>